!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@trademe/ng-defer-load",["exports","@angular/common","@angular/core","rxjs","rxjs/operators"],t):t(((e=e||self).trademe=e.trademe||{},e.trademe["ng-defer-load"]={}),e.ng.common,e.ng.core,e.rxjs,e.rxjs.operators)}(this,(function(e,t,r,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function i(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}var s=function(){function e(e,t,n){var o=this;this._element=e,this._zone=t,this.platformId=n,this.preRender=!0,this.fallbackEnabled=!0,this.removeListenersAfterLoad=!0,this.deferLoad=new r.EventEmitter,this.checkForIntersection=function(e){e.forEach((function(e){o.checkIfIntersecting(e)&&(o.load(),o._intersectionObserver&&o._element.nativeElement&&o._intersectionObserver.unobserve(o._element.nativeElement))}))},this.onScroll=function(){o.isVisible()&&o._zone.run((function(){return o.load()}))}}var s,c;return e.prototype.ngOnInit=function(){(t.isPlatformServer(this.platformId)&&!0===this.preRender||t.isPlatformBrowser(this.platformId)&&!1===this.fallbackEnabled&&!this.hasCompatibleBrowser())&&this.load()},e.prototype.ngAfterViewInit=function(){t.isPlatformBrowser(this.platformId)&&(this.hasCompatibleBrowser()?(this.registerIntersectionObserver(),this._intersectionObserver&&this._element.nativeElement&&this._intersectionObserver.observe(this._element.nativeElement)):!0===this.fallbackEnabled&&this.addScrollListeners())},e.prototype.hasCompatibleBrowser=function(){var e="IntersectionObserver"in window,t=window.navigator.userAgent.match(/Edge\/(\d*)\./i),r=!!t&&t.length>1,n=r&&!!t&&parseInt(t[1],10)>15;return e&&(!r||n)},e.prototype.ngOnDestroy=function(){this.removeListeners()},e.prototype.registerIntersectionObserver=function(){var e=this;this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver((function(t){e.checkForIntersection(t)}),{}))},e.prototype.checkIfIntersecting=function(e){return e&&e.time?e.isIntersecting&&e.target===this._element.nativeElement:this.isVisible()},e.prototype.load=function(){this.removeListenersAfterLoad&&this.removeListeners(),this.deferLoad.emit()},e.prototype.addScrollListeners=function(){var e=this;this.isVisible()?this.load():this._zone.runOutsideAngular((function(){e._scrollSubscription=n.fromEvent(window,"scroll").pipe(o.debounceTime(50)).subscribe(e.onScroll)}))},e.prototype.removeListeners=function(){this._scrollSubscription&&this._scrollSubscription.unsubscribe(),this._intersectionObserver&&this._intersectionObserver.disconnect()},e.prototype.isVisible=function(){var e=this.getScrollPosition();return this._element.nativeElement.getBoundingClientRect().top+(window.scrollY||window.pageYOffset)<=e},e.prototype.getScrollPosition=function(){return(window.scrollY||window.pageYOffset)+(document.documentElement.clientHeight||document.body.clientHeight)},e.ctorParameters=function(){return[{type:r.ElementRef},{type:r.NgZone},{type:Object,decorators:[{type:r.Inject,args:[r.PLATFORM_ID]}]}]},i([r.Input()],e.prototype,"preRender",void 0),i([r.Input()],e.prototype,"fallbackEnabled",void 0),i([r.Input()],e.prototype,"removeListenersAfterLoad",void 0),i([r.Output()],e.prototype,"deferLoad",void 0),e=i([r.Directive({selector:"[deferLoad]"}),(s=2,c=r.Inject(r.PLATFORM_ID),function(e,t){c(e,t,s)})],e)}(),c=function(){function e(){}return e=i([r.NgModule({imports:[t.CommonModule],declarations:[s],exports:[s]})],e)}();e.DeferLoadDirective=s,e.DeferLoadModule=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=trademe-ng-defer-load.umd.min.js.map